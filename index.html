<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>MDC • Veracidade (Lite)</title>
  <style>
    :root{
      --bg0:#05070c;
      --bg1:#070b13;
      --card: rgba(14, 22, 38, .78);
      --stroke: rgba(120, 170, 255, .18);
      --stroke2: rgba(120, 170, 255, .28);
      --text:#e9f2ff;
      --muted:#9fb4d6;

      --good:#57f3c0;
      --warn:#ffd166;
      --bad:#ff5c7a;
      --info:#64b5ff;

      --shadow: 0 18px 55px rgba(0,0,0,.55);
      --r: 22px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family:var(--sans);
      background:
        radial-gradient(900px 600px at 15% 10%, rgba(100,181,255,.16), transparent 60%),
        radial-gradient(800px 600px at 85% 20%, rgba(87,243,192,.10), transparent 55%),
        radial-gradient(900px 700px at 45% 95%, rgba(255,92,122,.08), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 45%, var(--bg0));
      overflow-x:hidden;
    }

    .wrap{
      min-height:100%;
      display:flex;
      align-items:stretch;
      justify-content:center;
      padding:16px 14px 22px;
    }

    .panel{
      width:min(520px, 100%);
      background: linear-gradient(180deg, rgba(14,22,38,.86), rgba(10,14,24,.76));
      border:1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    header{
      padding:14px 14px 10px;
      border-bottom:1px solid rgba(120,170,255,.14);
      background:
        radial-gradient(900px 160px at 10% 0%, rgba(100,181,255,.18), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,0));
    }

    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }

    .brand{
      display:flex;
      flex-direction:column;
      gap:4px;
      line-height:1.15;
    }

    .badge{
      font-family:var(--mono);
      font-size:11px;
      letter-spacing:.65px;
      text-transform:uppercase;
      color:var(--muted);
      padding:6px 10px;
      border:1px solid rgba(120,170,255,.22);
      border-radius:999px;
      width:fit-content;
      background:rgba(0,0,0,.14);
      user-select:none;
    }

    h1{
      margin:0;
      font-size:16px;
      letter-spacing:.2px;
    }

    .sub{
      color:var(--muted);
      font-family:var(--mono);
      font-size:11px;
    }

    .iconBtns{display:flex;gap:10px; align-items:center;}
    .iconBtn{
      appearance:none;
      border:1px solid rgba(120,170,255,.22);
      background:rgba(0,0,0,.14);
      color:var(--text);
      border-radius:14px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:800;
      font-family:var(--mono);
      user-select:none;
      transition:transform .08s ease, filter .12s ease, border-color .12s ease;
    }
    .iconBtn:hover{filter:brightness(1.08); border-color:rgba(120,170,255,.45)}
    .iconBtn:active{transform:translateY(1px)}

    main{padding:14px; display:flex; flex-direction:column; gap:14px;}

    .card{
      border:1px solid rgba(120,170,255,.16);
      background: rgba(0,0,0,.14);
      border-radius: 18px;
      padding:12px;
    }

    label{
      display:block;
      font-family:var(--mono);
      font-size:11px;
      letter-spacing:.5px;
      text-transform:uppercase;
      color:var(--muted);
      margin-bottom:8px;
    }

    .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap;}
    .grow{flex:1}

    input[type="range"]{
      width:100%;
      accent-color: #7ab0ff;
    }

    .dcLine{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-top:6px;
      font-family:var(--mono);
      color:#cfe4ff;
      font-size:12px;
    }
    .dcValue{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(120,170,255,.22);
      background:rgba(0,0,0,.14);
      user-select:none;
      white-space:nowrap;
    }

    .seg{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
    }

    .seg button{
      appearance:none;
      border:1px solid rgba(120,170,255,.20);
      background:rgba(0,0,0,.14);
      color:var(--text);
      padding:12px 10px;
      border-radius:16px;
      font-family:var(--mono);
      font-weight:800;
      cursor:pointer;
      user-select:none;
      transition:transform .08s ease, filter .12s ease, border-color .12s ease;
    }
    .seg button:hover{filter:brightness(1.08); border-color:rgba(120,170,255,.45)}
    .seg button:active{transform:translateY(1px)}
    .seg button.on{
      border-color: rgba(87,243,192,.40);
      background: rgba(87,243,192,.10);
      color: #dbfff3;
    }
    .seg small{
      display:block;
      opacity:.8;
      font-weight:650;
      margin-top:4px;
      font-size:10px;
    }

    .rollArea{
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:stretch;
    }

    .diceBox{
      position:relative;
      border-radius: 20px;
      border:1px solid rgba(120,170,255,.18);
      background:
        radial-gradient(350px 180px at 30% 20%, rgba(100,181,255,.16), transparent 60%),
        radial-gradient(300px 240px at 80% 80%, rgba(87,243,192,.12), transparent 60%),
        rgba(0,0,0,.12);
      padding:16px 12px;
      overflow:hidden;
      min-height:110px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .scan{
      position:absolute;
      inset:-40%;
      background:linear-gradient(transparent, rgba(100,181,255,.12), transparent);
      transform:rotate(18deg);
      animation:scan 5.2s linear infinite;
      opacity:.55;
      pointer-events:none;
    }
    @keyframes scan{
      0%{transform:translateY(-25%) rotate(18deg)}
      100%{transform:translateY(25%) rotate(18deg)}
    }

    .dice{
      width:86px;
      height:86px;
      border-radius:22%;
      border:1px solid rgba(120,170,255,.40);
      background:
        radial-gradient(circle at 35% 28%, rgba(255,255,255,.18), rgba(255,255,255,.06) 40%, rgba(0,0,0,0) 70%),
        linear-gradient(140deg, rgba(100,181,255,.18), rgba(0,0,0,.18));
      display:grid;
      place-items:center;
      transform:rotate(45deg);
      box-shadow: 0 16px 45px rgba(0,0,0,.55);
      flex:0 0 auto;
    }
    .dice span{
      transform:rotate(-45deg);
      font-family:var(--mono);
      font-weight:900;
      font-size:34px;
      text-shadow: 0 2px 0 rgba(0,0,0,.35);
      user-select:none;
    }
    .rolling .dice{animation:roll 780ms cubic-bezier(.2,.9,.2,1) infinite;}
    @keyframes roll{
      0%{transform:rotate(45deg) scale(1)}
      50%{transform:rotate(405deg) scale(1.06)}
      100%{transform:rotate(765deg) scale(1)}
    }

    .stat{
      display:flex;
      flex-direction:column;
      gap:6px;
      flex:1;
      min-width:190px;
    }
    .line{
      display:flex;
      justify-content:space-between;
      gap:10px;
      font-family:var(--mono);
      font-size:12px;
      color:#cfe4ff;
    }
    .line b{font-weight:900}
    .muted{color:var(--muted)}

    .bigBtn{
      appearance:none;
      width:100%;
      border:none;
      border-radius:20px;
      padding:16px 16px;
      font-size:16px;
      font-weight:900;
      letter-spacing:.4px;
      cursor:pointer;
      user-select:none;
      color:#071019;
      background: linear-gradient(180deg, rgba(87,243,192,.98), rgba(87,243,192,.75));
      box-shadow: 0 18px 45px rgba(0,0,0,.55);
      transition:transform .08s ease, filter .12s ease;
    }
    .bigBtn:active{transform:translateY(1px)}
    .bigBtn:hover{filter:brightness(1.03)}

    .result{
      border:1px solid rgba(120,170,255,.16);
      background: rgba(0,0,0,.14);
      border-radius:18px;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      width:fit-content;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(120,170,255,.20);
      background:rgba(0,0,0,.14);
      font-family:var(--mono);
      font-size:11px;
      color:var(--muted);
      user-select:none;
    }

    .tag{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:6px 10px;
      border-radius:999px;
      font-family:var(--mono);
      font-size:11px;
      font-weight:900;
      letter-spacing:.45px;
      border:1px solid rgba(120,170,255,.22);
      background:rgba(0,0,0,.12);
      user-select:none;
      white-space:nowrap;
    }
    .tag.good{border-color:rgba(87,243,192,.45); color:rgba(87,243,192,.98)}
    .tag.warn{border-color:rgba(255,209,102,.45); color:rgba(255,209,102,.98)}
    .tag.bad{border-color:rgba(255,92,122,.45); color:rgba(255,92,122,.98)}
    .tag.info{border-color:rgba(100,181,255,.45); color:rgba(100,181,255,.98)}

    .resultTop{display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;}
    .resultText{font-size:14px; line-height:1.35; color:#dbe9ff;}
    .hint{font-family:var(--mono); font-size:11px; color:var(--muted); line-height:1.3}

    footer{
      padding:12px 14px 14px;
      border-top:1px solid rgba(120,170,255,.14);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      background: rgba(0,0,0,.08);
    }
    .toggle{
      display:flex;
      align-items:center;
      gap:10px;
      font-family:var(--mono);
      font-size:11px;
      color:var(--muted);
      user-select:none;
    }
    input[type="checkbox"]{transform:scale(1.12)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel" id="panel">

      <header>
        <div class="top">
          <div class="brand">
            <div class="badge">MDC • VERACIDADE • LITE</div>
            <h1>Teste rápido de “acreditar ou não”</h1>
            <div class="sub">1 botão • Slider de DC • Facilidade/Dificuldade</div>
          </div>
          <div class="iconBtns">
            <button class="iconBtn" id="btnFS" title="Tela cheia">⛶</button>
          </div>
        </div>
      </header>

      <main>
        <!-- DC slider -->
        <div class="card">
          <label for="dc">Dificuldade (DC)</label>
          <input id="dc" type="range" min="5" max="18" step="1" value="12" />
          <div class="dcLine">
            <span class="muted" id="dcName">Ok</span>
            <span class="dcValue" id="dcVal">DC 12</span>
          </div>
        </div>

        <!-- Ease/Normal/Hard -->
        <div class="card">
          <label>Condição</label>
          <div class="seg" role="tablist" aria-label="Condição">
            <button id="modeAdv" type="button">
              Facilidade
              <small>2d20 pega o maior</small>
            </button>
            <button id="modeNorm" type="button" class="on">
              Normal
              <small>1d20</small>
            </button>
            <button id="modeDis" type="button">
              Dificuldade
              <small>2d20 pega o menor</small>
            </button>
          </div>
        </div>

        <!-- Roll -->
        <div class="rollArea">
          <div class="diceBox" id="diceBox">
            <div class="scan"></div>
            <div class="dice" aria-label="dado">
              <span id="d20">20</span>
            </div>
            <div class="stat">
              <div class="line"><span class="muted">Rolagem</span><b id="rollLine">—</b></div>
              <div class="line"><span class="muted">Total</span><b id="totalLine">—</b></div>
              <div class="line"><span class="muted">Margem</span><b id="marginLine">—</b></div>
            </div>
          </div>

          <button class="bigBtn" id="btnRoll">ROLAR</button>

          <div class="result" id="result">
            <div class="resultTop">
              <span class="pill" id="metaPill">Aguardando rolagem…</span>
              <span class="tag info" id="tag">PRONTO</span>
            </div>
            <div class="resultText" id="text">
              Ajuste a DC e toque em <b>ROLAR</b>.
            </div>
            <div class="hint" id="hint">
              Dica: “Facilidade/Dificuldade” é tipo vantagem/desvantagem — sem ficar complexo.
            </div>
          </div>
        </div>
      </main>

      <footer>
        <label class="toggle">
          <input type="checkbox" id="sound" checked />
          Sons
        </label>
        <label class="toggle">
          <input type="checkbox" id="crit" checked />
          Críticos (1/20)
        </label>
        <span class="pill" id="clock">--:--</span>
      </footer>

    </div>
  </div>

  <script>
    (() => {
      const el = (id) => document.getElementById(id);

      const dc = el("dc");
      const dcVal = el("dcVal");
      const dcName = el("dcName");

      const modeAdv = el("modeAdv");
      const modeNorm = el("modeNorm");
      const modeDis = el("modeDis");

      const diceBox = el("diceBox");
      const d20 = el("d20");

      const rollLine = el("rollLine");
      const totalLine = el("totalLine");
      const marginLine = el("marginLine");

      const btnRoll = el("btnRoll");
      const metaPill = el("metaPill");
      const tag = el("tag");
      const text = el("text");
      const hint = el("hint");

      const sound = el("sound");
      const crit = el("crit");
      const clock = el("clock");
      const btnFS = el("btnFS");

      // ----- state
      let mode = "NORMAL"; // ADV, NORMAL, DIS
      let audioCtx = null;
      let rolling = false;

      // DC names
      const dcLabels = new Map([
        [5, "Ridícula"],
        [8, "Ruim"],
        [10, "Fraca"],
        [12, "Ok"],
        [14, "Plausível"],
        [16, "Muito plausível"],
        [18, "Quase perfeita"],
      ]);

      const nearestLabel = (v) => {
        // exact hit or nearest below
        if (dcLabels.has(v)) return dcLabels.get(v);
        const keys = [...dcLabels.keys()].sort((a,b)=>a-b);
        let best = keys[0];
        for (const k of keys) if (k <= v) best = k;
        return dcLabels.get(best);
      };

      const setMode = (m) => {
        mode = m;
        modeAdv.classList.toggle("on", m === "ADV");
        modeNorm.classList.toggle("on", m === "NORMAL");
        modeDis.classList.toggle("on", m === "DIS");
        tinyBeep(520, 0.04);
      };

      // ----- audio
      const ensureAudio = async () => {
        if (!sound.checked) return null;
        if (audioCtx) return audioCtx;
        try {
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
          if (audioCtx.state === "suspended") await audioCtx.resume();
          return audioCtx;
        } catch { return null; }
      };

      const tinyBeep = async (freq=440, dur=0.05) => {
        const ctx = await ensureAudio();
        if (!ctx) return;
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = "triangle";
        o.frequency.value = freq;
        g.gain.value = 0.05;
        o.connect(g); g.connect(ctx.destination);
        o.start();
        o.stop(ctx.currentTime + dur);
      };

      const rollSound = async () => {
        const ctx = await ensureAudio();
        if (!ctx) return;
        for (let i=0;i<6;i++){
          setTimeout(()=>tinyBeep(280+i*55, 0.03), i*55);
        }
      };

      // ----- logic
      const randD20 = () => 1 + Math.floor(Math.random()*20);

      const outcomeFromMargin = (margin) => {
        // thresholds simples e “bons de RP”
        // >= +5  => não acredita forte
        // 0..+4 => não acredita (leve)
        // -4..-1 => acredita com cautela
        // <= -5 => acredita total
        if (margin >= 5) return "SUCCESS_FULL";
        if (margin >= 0) return "SUCCESS_PARTIAL";
        if (margin >= -4) return "FAIL_PARTIAL";
        return "FAIL_FULL";
      };

      const uiForOutcome = (tier, isNat20, isNat1) => {
        // texto curto, sem enrolar
        if (tier === "SUCCESS_FULL") {
          return {
            pill: "Você NÃO acredita (forte)",
            tagClass: "tag good",
            tagText: "NÃO ACREDITA",
            body: "A história não fecha. Conteste, peça detalhes e faça checagens (placa/ID/evidência) conforme RP.",
            hint: "Sugestão: pressão verbal + verificação objetiva (sem virar WinRP)."
          };
        }
        if (tier === "SUCCESS_PARTIAL") {
          return {
            pill: "Você NÃO acredita (leve)",
            tagClass: "tag warn",
            tagText: "DESCONFIA",
            body: "Tem algo estranho. Você não compra 100%, mas ainda precisa de confirmação com perguntas/checagem.",
            hint: "Sugestão: “Aceito por enquanto, mas vou conferir X e Y”."
          };
        }
        if (tier === "FAIL_PARTIAL") {
          return {
            pill: "Você acredita (com cautela)",
            tagClass: "tag info",
            tagText: "CAUTELOSO",
            body: "Faz sentido o bastante. Você tende a aceitar, mas mantém atenção e faz 1 checagem rápida se couber.",
            hint: "Sugestão: anotar info, observar nervosismo/contradições, acompanhar discretamente."
          };
        }
        // FAIL_FULL
        return {
          pill: "Você acredita (total)",
          tagClass: "tag bad",
          tagText: "ACEITA",
          body: "A explicação parece legítima. Você aceita e segue o procedimento básico, sem escalada extra.",
          hint: "Sugestão: finalize a abordagem e siga o fluxo normal."
        };
      };

      const renderDC = () => {
        const v = Number(dc.value);
        dcVal.textContent = `DC ${v}`;
        dcName.textContent = nearestLabel(v);
      };

      const setRollingVisual = (on) => {
        diceBox.classList.toggle("rolling", on);
      };

      const animateDice = (finalValue) => {
        // animação leve: troca números enquanto gira
        const start = performance.now();
        const dur = 900 + Math.floor(Math.random()*400);
        setRollingVisual(true);

        const tick = (t) => {
          const p = (t - start) / dur;
          if (p < 1) {
            d20.textContent = String(randD20());
            requestAnimationFrame(tick);
          } else {
            setRollingVisual(false);
            d20.textContent = String(finalValue);
          }
        };
        requestAnimationFrame(tick);
      };

      const doRoll = async () => {
        if (rolling) return;
        rolling = true;

        await ensureAudio();
        rollSound();

        const dcValue = Number(dc.value);

        let r1 = randD20();
        let r2 = randD20();
        let used = r1;
        let rawDisplay = `${r1}`;

        if (mode === "ADV") {
          used = Math.max(r1, r2);
          rawDisplay = `${r1} & ${r2} → pega ${used}`;
        } else if (mode === "DIS") {
          used = Math.min(r1, r2);
          rawDisplay = `${r1} & ${r2} → pega ${used}`;
        }

        animateDice(used);

        // aguarda animação “parecer” terminar
        const wait = (ms) => new Promise(res => setTimeout(res, ms));
        await wait(1050);

        const isNat20 = used === 20;
        const isNat1 = used === 1;

        let margin = used - dcValue;

        // críticos opcionais (sem complicar)
        if (crit.checked) {
          // 20 natural “puxa pra cima” pelo menos pra sucesso parcial
          if (isNat20 && margin < 0) margin = 0;
          // 1 natural “puxa pra baixo” pelo menos pra falha parcial
          if (isNat1 && margin >= 0) margin = -1;
        }

        const tier = outcomeFromMargin(margin);
        const ui = uiForOutcome(tier, isNat20, isNat1);

        // UI lines
        rollLine.textContent = rawDisplay;
        totalLine.textContent = `${used} (sem mods)`;
        marginLine.textContent = `${margin >= 0 ? "+" : ""}${margin}`;

        metaPill.textContent = `${ui.pill} • DC ${dcValue}`;
        tag.className = ui.tagClass;
        tag.textContent = ui.tagText;

        let extra = "";
        if (crit.checked && isNat20) extra = " (20 natural)";
        if (crit.checked && isNat1) extra = " (1 natural)";
        text.innerHTML = `${ui.body}<b>${extra}</b>`;
        hint.textContent = ui.hint;

        // som final
        if (sound.checked) {
          if (isNat20) tinyBeep(880, 0.08);
          else if (isNat1) tinyBeep(200, 0.08);
          else tinyBeep(margin >= 0 ? 640 : 360, 0.06);
        }

        rolling = false;
      };

      // ----- clock
      const tickClock = () => {
        const d = new Date();
        clock.textContent = `${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`;
      };

      // ----- fullscreen
      const toggleFullscreen = async () => {
        try{
          if(!document.fullscreenElement) await document.documentElement.requestFullscreen();
          else await document.exitFullscreen();
        }catch{}
      };

      // ----- bindings
      dc.addEventListener("input", renderDC);

      modeAdv.addEventListener("click", ()=>setMode("ADV"));
      modeNorm.addEventListener("click", ()=>setMode("NORMAL"));
      modeDis.addEventListener("click", ()=>setMode("DIS"));

      btnRoll.addEventListener("click", doRoll);
      btnFS.addEventListener("click", toggleFullscreen);

      // Space = roll (bom no PC)
      window.addEventListener("keydown", (e) => {
        if (e.code === "Space") {
          e.preventDefault();
          doRoll();
        }
      }, {passive:false});

      // iOS/Chrome: liberar audio com primeiro toque
      document.addEventListener("pointerdown", async () => {
        if(sound.checked) await ensureAudio();
      }, { once:true });

      // init
      renderDC();
      setMode("NORMAL");
      tickClock();
      setInterval(tickClock, 10_000);
    })();
  </script>
</body>
</html>

